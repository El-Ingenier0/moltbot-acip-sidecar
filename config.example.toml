[service]
# If running as root (e.g., systemd service), the sidecar can drop privileges
# to the configured user/group before serving.
# If running as non-root, enforce_identity=true requires the process already
# matches the configured identity.
user = "acip_user"
group = "acip_user"
enforce_identity = true

[server]
host = "127.0.0.1"
port = 18795
# unix_socket = "/run/acip/acip-sidecar.sock"

[policy]
# policies_file = "/etc/acip/policies.json"
head = 4000
tail = 4000
full_if_lte = 9000

[normalize]
# Markup normalization caps (HTML/SVG only).
# When the raw markup exceeds max_input_chars, we normalize a window consisting
# of window_head_chars + window_tail_chars with a marker inserted between:
# "[...TRUNCATED_FOR_NORMALIZATION...]".
#
# Tradeoffs:
# - Lower limits reduce parser CPU/memory and mitigate pathological inputs.
# - Smaller head/tail windows can drop important context in the middle.
# - Keep head + tail <= max_input_chars (marker adds extra chars) to avoid
#   exceeding the intended cap.
max_input_chars = 400000
window_head_chars = 200000
window_tail_chars = 200000

# Adversarial markup detection (signal only): if triggered, tighten the above caps.
# This is NOT a security boundary; it simply reduces workload on suspicious inputs.
#
# threshold: combined severity score from xml_scan + html_scan.
adversarial_threshold = 3
# factor: multiplier applied to caps when adversarial_threshold is met.
adversarial_tighten_factor = 0.5

[security]
allow_insecure_loopback = true
require_token = false
token_env = "ACIP_AUTH_TOKEN"
